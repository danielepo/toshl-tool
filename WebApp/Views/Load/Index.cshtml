@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model WebApp.Controllers.HomeVM

<script type="text/javascript">
    $(document).ready(function () {

    });
    function selectRow(elm) {
        $("#start").val($(elm).text());
    }
</script>
<h2>Entries Analysis</h2>

    @if (Model.Reports.Any(x => !x.Tagged))
    {
        using (Html.BeginForm("Index", "Load", FormMethod.Post))
        {
            <h3>Add Rule</h3>
            <div class="form-group">
                @Html.Label("tag", "Tag")
                @Html.DropDownList("tag", Model.Tags, new { @class = "form-control" })
            </div>
            <div class="form-group">
                @Html.Label("rule", "Rule")
                @Html.DropDownList("rule", Model.Rules, new { @class = "form-control" })
            </div>
            <div class="form-group">
                @Html.Label("start", "Start String")
                <input type="text" id="start" name="start" style="max-width: 1000px; width: 100%" class="form-control" />
            </div>
            <div class="form-group"><input type="submit" value="send" class="btn btn-default" /></div>
        }
        <h3>Not Tagged</h3>
        <table class="table table-hover table-condensed table-bordered">
            <thead>
                <tr>
                    <th>Value</th>
                    <th>Date</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>

                @foreach (var m in Model.Reports.Where(x => !x.Tagged))
                {
                    var trClass = m.Type.IsExpence ? "danger" : "success";
                    <tr class="@trClass">
                        <td>@m.Ammount.ToString("C")</td>
                        <td>@m.Date.ToShortDateString()</td>
                        <td onclick="selectRow(this)">@m.Description.Substring(0, 150)</td>
                    </tr>
                }
            </tbody>

        </table>
    }

    @{
        var reports = Model.Reports
            .Where(x => x.Tagged)
            .GroupBy(x => x.Type)
            .Select(x => new { Type = x.Key, G = x.GroupBy(y => y.Tag) });

    }
    @if (reports.Any())
    {

        <h3>Already Tagged</h3>
        <table class="table table-hover table-condensed table-bordered">
            <thead><tr><th>Tag</th><th>Total</th></tr></thead>
            <tbody>

                @foreach (var m in reports)
                {
                    var trClass = m.Type.IsExpence ? "danger" : "success";

                    foreach (var g in m.G)
                    {
                        <tr class="@trClass">
                            <td>@Model.Tags.First(x => x.Value == g.Key.ToString()).Text</td>
                            <td>@g.Sum(x => x.Ammount).ToString("C")</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
        using (Html.BeginForm("Save", "Load", FormMethod.Post))
        {
            <h3>Save Entries</h3>

            <div class="form-group">
                @Html.Label("account", "Account")
                @Html.DropDownList("account", Model.Accounts, new { @class = "form-control" })
            </div>
            <div class="form-group">
                <input type="submit" value="Submit" class="btn btn-default" />
            </div>
        }
    }



    @if (Model.IgnoredReports.Any())
    {
        <h3>Ignored</h3>
        <table class="table table-hover table-condensed table-bordered">
            <thead>
                <tr>
                    <th>Value</th>
                    <th>Date</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>

                @foreach (var m in Model.IgnoredReports)
                {
                    var trClass = m.Type.IsExpence ? "danger" : "success";
                    <tr class="@trClass">
                        <td>@m.Ammount.ToString("C")</td>
                        <td>@m.Date.ToShortDateString()</td>
                        <td>@m.Description.Substring(0, 150)</td>
                    </tr>
                }
            </tbody>
        </table>
    }

@Html.ActionLink("Back to Home", "Index", "Home")